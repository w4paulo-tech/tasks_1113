{% extends "base.html" %}

{% block title %}Darbuotojas{% endblock %}

{% block content %}
<h2>Darbuotojo informacija: </h2>
<hr>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <p><b>Darbuotojas: </b> {{ worker.full_name.title }}</p>
      <p><b>Pareigos: </b> ----</p>
      <div class="d-flex align-items-center">
      <p><b>Pamaina: </b>{{ worker.get_shift_display }}</p>
      {% if user.is_staff %}
      <form method="post" class="d-flex ms-auto" enctype="multipart/form-data">
      {% csrf_token %}
      {% load crispy_forms_tags %}
      {{ form.shift | as_crispy_field }}
      <div class="ms-1">
        <button type="submit" class="btn btn-outline-success">Pakeisti</button>
      </div>
      </form>
      {% endif %}
      </div>
    </div>
  </div>  
</div>
<div class="d-flex align-items-center">
<h2>Paskirtos užduotys: </h2>
  <a class="btn btn-outline-dark ms-auto" href="{% url 'uzduotis_create' worker.pk %}">Pridėti užduotį +</a>
</div>
  <hr>
<table class="table table-hover">
  <thead>
    <tr>
      <th>Apie užduotį</th>
      <th>Užduotis</th>
      <th>Sukūrė</th>
      <th>Statusas</th>
      <th>Terminas</th>
    </tr>
  </thead>
  <tbody id="task-accordion">
    {% for instance in worker.tasks.all %}
    <tr class="{% if instance.status == 'a' %}table-success
               {% elif instance.status == 'p' %}table-danger
               {% elif instance.status == 'n' %}table-warning{% endif %}">
      <td class="d-flex justify-content-center">
        <button
        class="btn btn-sm btn-outline-dark w-75"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapse-{{ instance.id}}">
        Plačiau
        </button>
      </td>
      <td>{{ instance.task.name }}</td>
      <td>{{ instance.user }}</td>
      <td>{{ instance.get_status_display }}</td>
      <td>{{ instance.due_date | date:"Y-m-d H:i:s"}}</td> 
    </tr>
    <tr class="collapse" id="collapse-{{ instance.id }}"  data-bs-parent="#task-accordion">
      <td colspan="5">
          <div class="p-2 bg-light border rounded">
              <p><b>Plačiau apie užduotį:</b></p>
              <ul>
                  <li style="font-size: 15px;"><b>Atsakingi darbuotojai: </b>
                    {% for worker in instance.worker.all %}
                    {{ worker.full_name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                  </li>
                  <li style="font-size: 15px;">
                    <b>Užduotis sukurta: </b>{{ instance.date | date:"Y-m-d H:i:s"}}
                  </li>
                  <li style="font-size: 15px;">
                    <b>Užduoties aprašymas: </b>{{ instance.task.content }}
                  </li>
                  {% if instance.notes %}
                  <li class="mb-2"  style="font-size: 15px;">
                    <b>Užduoties komentaras: </b>{{ instance.notes }}
                  </li>
                  {% endif %}
                  {% if user.is_staff or user == instance.user %}
                  <div class="d-flex mt-2">
                      <a class="btn btn-outline-primary me-2" href="{% url 'uzduotis_update' worker.pk instance.pk %}">Redaguoti užduotį</a>
                      <a class="btn btn-outline-danger" href="{% url 'uzduotis_delete' worker.pk instance.pk %}">Ištrinti užduotį</a>
                  </div>    
                      {% endif %}
              </ul>
          </div>
      </td>
    </tr>
    {% endfor %}
</tbody>

</table>
{% endblock %}